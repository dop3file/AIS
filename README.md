# University Audio System

Система управления аудиотрансляциями для университетских кампусов с поддержкой периодических уведомлений, записи через браузер и ролевым доступом.

## Описание

University Audio System позволяет управлять аудиовещанием в различных зонах университета (общежития, учебные корпуса, столовые). Поддерживается создание одноразовых и повторяющихся уведомлений, запись аудио прямо в браузере, а также полноценная система аналитики и мониторинга.

## Основной функционал

### Аутентификация
- Регистрация и вход пользователей
- JWT-токены с 30-минутной сессией
- Роли: администратор и обычный пользователь
- Защищенные маршруты на фронтенде и бэкенде

### Управление аудио
- Загрузка аудиофайлов в S3-хранилище (MinIO)
- Запись аудио через браузер с использованием MediaRecorder API
- Предпросмотр и воспроизведение файлов
- Автоматическая генерация presigned URLs

### Уведомления
- Создание разовых уведомлений с привязкой к зоне и времени
- Периодические уведомления (ежедневно, еженедельно, ежемесячно)
- Опциональная дата окончания повторений
- Привязка текстового сообщения к аудио

### Зоны вещания
- CRUD операции для управления зонами
- Привязка зон к физическим локациям
- Выбор зоны при создании уведомления

### Административная панель
- Список всех пользователей
- Изменение ролей пользователей
- Активация/деактивация аккаунтов
- Удаление пользователей (кроме самого себя)

### Аналитика и мониторинг
- Metabase для бизнес-аналитики
- Grafana + Prometheus для мониторинга API
- Метрики запросов, время ответа, статусы кодов

## Технологический стек

### Backend
- FastAPI - REST API фреймворк
- SQLAlchemy - ORM для работы с PostgreSQL
- Alembic - миграции базы данных
- JWT - аутентификация
- Boto3 - взаимодействие с S3

### Frontend
- React 18 - UI библиотека
- React Router - маршрутизация
- Axios - HTTP клиент
- Vite - сборщик

### Инфраструктура
- PostgreSQL - основная база данных
- MinIO - S3-совместимое хранилище
- Metabase - аналитическая панель
- Prometheus - сбор метрик
- Grafana - визуализация метрик
- Docker Compose - оркестрация контейнеров

### Тестирование
- pytest - тесты бэкенда (28 тестов)
- Vitest + React Testing Library - тесты фронтенда (10 тестов)
- Покрытие: 100% для критичных функций

## Быстрый старт

### Требования
- Docker и Docker Compose
- Git

### Запуск

```bash
# Клонировать репозиторий
git clone https://github.com/dop3file/AIS.git
cd AIS

# Запустить все сервисы
docker compose up -d

# Создать админа
docker exec ais_backend python scripts/create_admin.py
```

## Запуск тестов

```bash
# Все тесты (backend + frontend)
make test

# Только backend
make test-backend

# Только frontend
make test-frontend
```

Результаты: 38 из 38 тестов проходят (100%).

## Структура проекта

```
AIS/
├── app/                    # Backend приложение
│   ├── api/               # API endpoints
│   ├── core/              # Конфигурация, security, database
│   ├── models/            # SQLAlchemy модели
│   ├── schemas/           # Pydantic схемы
│   └── services/          # Бизнес-логика
├── frontend/              # React приложение
│   └── src/
│       ├── components/    # React компоненты
│       ├── contexts/      # Context providers
│       ├── pages/         # Страницы приложения
│       └── tests/         # Frontend тесты
├── tests/                 # Backend тесты
├── alembic/              # Миграции БД
├── scripts/              # Утилиты и скрипты
└── docker-compose.yml    # Конфигурация Docker
```

## Мониторинг

### Grafana
Дашборд содержит:
- Общее количество запросов
- Среднее время ответа
- Распределение HTTP статусов
- Метрики по эндпоинтам

### Metabase
Аналитика:
- Статистика пользователей
- Использование зон
- Частота уведомлений
- Загрузка аудиофайлов
